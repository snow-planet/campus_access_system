# 部署前检查清单

## 🔍 部署前必须检查的项目

### 1. 服务器环境检查

- [ ] **服务器配置**
  - [ ] CPU: 2核心以上
  - [ ] 内存: 4GB以上
  - [ ] 硬盘: 50GB以上可用空间
  - [ ] 操作系统: CentOS 7+ / Ubuntu 18+

- [ ] **宝塔面板环境**
  - [ ] 宝塔面板版本: 7.0+
  - [ ] Nginx: 1.20+
  - [ ] MySQL: 5.7+ 或 8.0+
  - [ ] Node.js: 18.0+
  - [ ] PM2: 已安装
  - [ ] SSL证书: 已配置

### 2. 域名和网络检查

- [ ] **域名配置**
  - [ ] 域名解析: campus.gxwxit.top -> 服务器IP
  - [ ] DNS生效: 使用 `nslookup campus.gxwxit.top` 验证
  - [ ] 备案状态: 域名已完成ICP备案（如需要）

- [ ] **网络安全**
  - [ ] 防火墙端口: 80, 443, 3001 已开放
  - [ ] SSH密钥: 已配置密钥登录
  - [ ] 安全组: 云服务器安全组已正确配置

### 3. 数据库准备

- [ ] **MySQL配置**
  - [ ] 数据库名: `campus_access_system`
  - [ ] 数据库用户: `campus_user`
  - [ ] 用户权限: 已授权所有必要权限
  - [ ] 字符集: utf8mb4
  - [ ] 时区: Asia/Shanghai

- [ ] **数据库安全**
  - [ ] root密码: 已设置强密码
  - [ ] 远程访问: 已禁用root远程登录
  - [ ] 备份策略: 已配置自动备份

### 4. 微信配置检查

- [ ] **微信小程序**
  - [ ] AppID: 已获取并记录
  - [ ] AppSecret: 已获取并记录
  - [ ] 服务器域名: 已在小程序后台配置 `campus.gxwxit.top`
  - [ ] 业务域名: 已配置（如需要）

- [ ] **微信云开发**
  - [ ] 云开发环境: 已创建
  - [ ] 环境ID: 已记录
  - [ ] 资源配置: 已根据需求配置

### 5. 代码准备检查

- [ ] **后端代码**
  - [ ] 依赖安装: `npm install` 无错误
  - [ ] 环境变量: `.env.production` 已配置
  - [ ] 数据库连接: 测试连接成功
  - [ ] JWT密钥: 已设置安全的密钥

- [ ] **前端代码**
  - [ ] 构建测试: `npm run build` 成功
  - [ ] 静态资源: dist目录生成正常
  - [ ] API地址: 已配置为生产环境地址

- [ ] **uni-app代码**
  - [ ] 小程序配置: manifest.json已更新
  - [ ] API地址: 已配置为生产环境地址
  - [ ] 云开发配置: 已配置正确的环境ID

### 6. 安全配置检查

- [ ] **密钥安全**
  - [ ] JWT_SECRET: 使用强随机密钥
  - [ ] 数据库密码: 使用强密码
  - [ ] 微信密钥: 妥善保管AppSecret

- [ ] **HTTPS配置**
  - [ ] SSL证书: 已申请并配置
  - [ ] 强制HTTPS: 已启用
  - [ ] HSTS: 已配置

### 7. 性能优化检查

- [ ] **前端优化**
  - [ ] Gzip压缩: 已启用
  - [ ] 静态资源缓存: 已配置
  - [ ] CDN: 已配置（可选）

- [ ] **后端优化**
  - [ ] 数据库连接池: 已配置
  - [ ] 日志级别: 生产环境已调整
  - [ ] 内存限制: PM2已配置内存限制

## 🔧 部署步骤确认

### 步骤1: 服务器准备
- [ ] 服务器已购买并配置
- [ ] 宝塔面板已安装
- [ ] 必要软件已安装

### 步骤2: 域名配置
- [ ] 域名解析已配置
- [ ] SSL证书已申请

### 步骤3: 数据库部署
- [ ] 数据库已创建
- [ ] 用户权限已配置
- [ ] 初始数据已导入

### 步骤4: 后端部署
- [ ] 代码已上传
- [ ] 依赖已安装
- [ ] 环境变量已配置
- [ ] PM2服务已启动

### 步骤5: 前端部署
- [ ] 静态文件已上传
- [ ] Nginx配置已更新
- [ ] 路由配置已测试

### 步骤6: 小程序部署
- [ ] 代码已构建
- [ ] 微信开发者工具已上传
- [ ] 审核已提交

## 🧪 测试验证清单

### 功能测试
- [ ] **Web前端**
  - [ ] 首页加载正常
  - [ ] 用户登录功能
  - [ ] 管理员登录功能
  - [ ] 个人预约流程
  - [ ] 团体预约流程
  - [ ] 审批功能
  - [ ] 公告管理

- [ ] **API接口**
  - [ ] 健康检查: `GET /api/health`
  - [ ] 用户认证: `POST /api/web/auth/login`
  - [ ] 预约创建: `POST /api/web/individual-reservations`
  - [ ] 审批操作: `POST /api/web/approval/action`

- [ ] **小程序**
  - [ ] 小程序启动正常
  - [ ] 微信登录功能
  - [ ] 预约功能
  - [ ] 查询功能

### 性能测试
- [ ] **响应时间**
  - [ ] 首页加载 < 3秒
  - [ ] API响应 < 1秒
  - [ ] 数据库查询 < 500ms

- [ ] **并发测试**
  - [ ] 100用户并发访问
  - [ ] 数据库连接池测试
  - [ ] 内存使用监控

### 安全测试
- [ ] **HTTPS验证**
  - [ ] SSL证书有效
  - [ ] 强制HTTPS重定向
  - [ ] 安全头配置

- [ ] **权限验证**
  - [ ] 未授权访问拦截
  - [ ] JWT token验证
  - [ ] 角色权限控制

## 📋 部署后监控

### 系统监控
- [ ] **服务状态**
  - [ ] PM2进程监控
  - [ ] Nginx状态监控
  - [ ] MySQL状态监控

- [ ] **资源监控**
  - [ ] CPU使用率 < 80%
  - [ ] 内存使用率 < 80%
  - [ ] 磁盘使用率 < 80%

### 日志监控
- [ ] **应用日志**
  - [ ] 后端应用日志正常
  - [ ] Nginx访问日志
  - [ ] 错误日志监控

- [ ] **告警配置**
  - [ ] 服务异常告警
  - [ ] 资源使用告警
  - [ ] 错误率告警

## 🚨 应急预案

### 回滚计划
- [ ] **数据备份**
  - [ ] 数据库备份文件位置已记录
  - [ ] 代码备份文件位置已记录
  - [ ] 配置文件备份已保存

- [ ] **回滚步骤**
  - [ ] 停止新服务
  - [ ] 恢复备份数据
  - [ ] 启动旧服务
  - [ ] 验证功能正常

### 故障处理
- [ ] **联系方式**
  - [ ] 技术负责人联系方式
  - [ ] 服务商技术支持
  - [ ] 域名服务商联系方式

- [ ] **故障排查**
  - [ ] 日志查看命令已准备
  - [ ] 服务重启命令已准备
  - [ ] 监控工具已配置

## ✅ 最终确认

在开始部署前，请确认以下所有项目都已完成：

- [ ] 所有检查项目都已完成
- [ ] 备份策略已制定并测试
- [ ] 应急预案已准备
- [ ] 相关人员已通知
- [ ] 部署时间已安排（建议在低峰期）

**部署负责人签名**: ________________

**日期**: ________________

**备注**: ________________